<!-- templates/components/business/workflow_timeline.html -->
{% if data.has_timeline %}
<div class="workflow-timeline-container">
    <!-- Current Status Badge -->
    <div class="mb-6">
        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
            {% if data.current_status == 'approved' or data.current_status == 'completed' %}
                bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300
            {% elif data.current_status == 'pending' or data.current_status == 'pending_approval' %}
                bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300
            {% elif data.current_status == 'rejected' %}
                bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300
            {% else %}
                bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300
            {% endif %}">
            <i class="fas fa-circle text-xs mr-2"></i>
            Current Status: {{ data.current_status|title|replace('_', ' ') }}
        </span>
    </div>

    <!-- Timeline - Fixed positioning and spacing -->
    <div class="relative pl-8">
        {% for step in data['steps'] %}
        <div class="flex items-start mb-6 relative">
            <!-- Timeline Line (except for last item) -->
            {% if not loop.last %}
            <div class="absolute left-4 top-8 w-0.5 h-full bg-gray-200 dark:bg-gray-700"></div>
            {% endif %}
            
            <!-- Timeline Icon - Fixed positioning -->
            <div class="absolute left-0 w-8 h-8 rounded-full flex items-center justify-center z-10
                {% if step.color == 'success' %}
                    bg-green-500 text-white
                {% elif step.color == 'info' %}
                    bg-blue-500 text-white
                {% elif step.color == 'warning' %}
                    bg-yellow-500 text-white
                {% elif step.color == 'danger' %}
                    bg-red-500 text-white
                {% else %}
                    bg-gray-500 text-white
                {% endif %}">
                <i class="{{ step.icon }} text-sm"></i>
            </div>
            
            <!-- Timeline Content - Adjusted margin -->
            <div class="ml-10 flex-1">
                <h4 class="text-sm font-medium text-gray-900 dark:text-gray-100">
                    {{ step.title }}
                </h4>
                
                {% if step.description %}
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                    {{ step.description }}
                </p>
                {% endif %}
                
                <!-- Timestamp and User on same line -->
                <div class="flex flex-wrap items-center gap-3 mt-2">
                    {% if step.timestamp %}
                    <span class="text-xs text-gray-500 dark:text-gray-400">
                        <i class="far fa-clock mr-1"></i>
                        {% if step.timestamp is string %}
                            {{ step.timestamp }}
                        {% else %}
                            {{ step.timestamp.strftime('%b %d, %Y at %I:%M %p') if step.timestamp else '' }}
                        {% endif %}
                    </span>
                    {% endif %}
                    
                    {% if step.user %}
                    <span class="text-xs text-gray-500 dark:text-gray-400">
                        <i class="far fa-user mr-1"></i>
                        {{ step.user }}
                    </span>
                    {% endif %}
                </div>
                
                {% if step.notes %}
                <div class="mt-2 p-2 bg-gray-50 dark:bg-gray-800 rounded text-xs text-gray-600 dark:text-gray-400">
                    <strong>Notes:</strong> {{ step.notes }}
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% else %}
<!-- No timeline data -->
<div class="text-center py-8">
    <i class="fas fa-history text-4xl text-gray-300 dark:text-gray-600 mb-3"></i>
    <p class="text-gray-500 dark:text-gray-400">No workflow history available</p>
</div>
{% endif %}