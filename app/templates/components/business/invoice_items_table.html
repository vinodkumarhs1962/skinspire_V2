<!-- Invoice Items Table Template with Footer Totals -->
<!-- File: app/templates/components/business/invoice_items_table.html -->

{% if data.has_lines %}
<div class="invoice-items-container w-100">
    <div class="table-responsive">
        <table class="table table-bordered table-hover invoice-items-table w-100">
            <thead class="table-light">
                <tr>
                    <th width="5%" class="text-center">#</th>
                    <th width="30%">Item Name</th>
                    <th width="10%" class="text-center">Batch</th>
                    <th width="8%" class="text-center">Expiry</th>
                    <th width="7%" class="text-end">Qty</th>
                    <th width="10%" class="text-end">Rate</th>
                    <th width="8%" class="text-end">Discount</th>
                    <th width="7%" class="text-end">GST%</th>
                    <th width="8%" class="text-end">GST Amt</th>
                    <th width="7%" class="text-end">Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in data['items'] %}
                <tr class="{% if item.is_free %}table-info{% endif %}">
                    <td class="text-center">{{ loop.index }}</td>
                    <td>
                        <strong>{{ item.medicine_name }}</strong>
                        {% if item.is_free %}
                            <span class="badge bg-info ms-2">FREE</span>
                        {% endif %}
                    </td>
                    <td class="text-center">{{ item.batch_number|default('-', true) }}</td>
                    <td class="text-center">{{ item.expiry_date|default('-', true) }}</td>
                    <td class="text-end">{{ "{:,.0f}".format(item.quantity) }}</td>
                    <td class="text-end">₹{{ "{:,.2f}".format(item.unit_price) }}</td>
                    <td class="text-end">
                        {% if item.discount_amount > 0 %}
                            ₹{{ "{:,.2f}".format(item.discount_amount) }}
                            {% if item.discount_percent > 0 %}
                                <small class="text-muted">({{ "{:.0f}".format(item.discount_percent) }}%)</small>
                            {% endif %}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td class="text-end">{{ "{:.0f}".format(item.gst_rate|default(0, true)) }}%</td>
                    <td class="text-end">₹{{ "{:,.2f}".format(item.gst_amount) }}</td>
                    <td class="text-end"><strong>₹{{ "{:,.2f}".format(item.line_total) }}</strong></td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot class="table-light">
                <!-- Subtotal Row -->
                <tr>
                    <td colspan="9" class="text-end"><strong>Subtotal:</strong></td>
                    <td class="text-end"><strong>₹{{ "{:,.2f}".format(data.summary.total_amount) }}</strong></td>
                </tr>
                
                <!-- Discount Row (if applicable) -->
                {% if data.summary.total_discount > 0 %}
                <tr>
                    <td colspan="9" class="text-end"><strong>Total Discount:</strong></td>
                    <td class="text-end text-danger"><strong>-₹{{ "{:,.2f}".format(data.summary.total_discount) }}</strong></td>
                </tr>
                {% endif %}
                
                <!-- GST Row -->
                <tr>
                    <td colspan="9" class="text-end"><strong>Total GST:</strong></td>
                    <td class="text-end"><strong>₹{{ "{:,.2f}".format(data.summary.total_gst) }}</strong></td>
                </tr>
                
                <!-- Grand Total Row -->
                <tr class="table-primary">
                    <td colspan="9" class="text-end"><strong>Grand Total:</strong></td>
                    <td class="text-end"><strong class="text-primary">₹{{ "{:,.2f}".format(data.summary.grand_total) }}</strong></td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

{% else %}
<!-- No Line Items Message -->
<div class="alert alert-info">
    <i class="fas fa-info-circle"></i> 
    {{ data.message|default('No line items found for this invoice.', true) }}
</div>
{% endif %}

<!-- Error Message (if any) -->
{% if data.has_error %}
<div class="alert alert-danger">
    <i class="fas fa-exclamation-triangle"></i> 
    <strong>Error:</strong> {{ data.error }}
</div>
{% endif %}

<style>
/* Invoice Items Table Styling */
.invoice-items-table {
    font-size: 0.9rem;
    width: 100% !important;
}

.invoice-items-table thead th {
    background-color: #f8f9fa;
    font-weight: 600;
    border-bottom: 2px solid #dee2e6;
    vertical-align: middle;
}

.invoice-items-table tbody td {
    vertical-align: middle;
}

.invoice-items-table tfoot td {
    font-weight: 500;
    vertical-align: middle;
}

.invoice-items-table tbody tr:hover {
    background-color: #f8f9fa;
}

.table-primary td {
    background-color: #cfe2ff !important;
}

/* Alignment classes */
.text-end {
    text-align: right !important;
}

.text-center {
    text-align: center !important;
}

/* Full width */
.w-100 {
    width: 100% !important;
}

.table-responsive {
    width: 100%;
    overflow-x: auto;
}
</style>