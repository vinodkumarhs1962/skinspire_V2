2025-03-25 18:11:17,839 - INFO - Running tests with configuration:
2025-03-25 18:11:17,839 - INFO -   all: True
2025-03-25 18:11:17,839 - INFO -   config: False
2025-03-25 18:11:17,840 - INFO -   backup: False
2025-03-25 18:11:17,840 - INFO -   copy: False
2025-03-25 18:11:17,840 - INFO -   triggers: False
2025-03-25 18:11:17,840 - INFO -   switch_env: False
2025-03-25 18:11:17,841 - INFO -   inspect_db: False
2025-03-25 18:11:17,841 - INFO -   schema: False
2025-03-25 18:11:17,841 - INFO - 
[36m============================================================
2025-03-25 18:11:17,841 - INFO -                   TESTING CONFIGURATION                  
2025-03-25 18:11:17,841 - INFO - ============================================================[0m
2025-03-25 18:11:17,845 - INFO - Reading database URLs from .env file
2025-03-25 18:11:17,845 - INFO - Found database URLs:
2025-03-25 18:11:17,845 - INFO -   FLASK_ENV: test
2025-03-25 18:11:17,845 - INFO -   DEV_DATABASE_URL: postgresql://skinspire_admin:***@localhost:5432/skinspire_dev
2025-03-25 18:11:17,846 - INFO -   TEST_DATABASE_URL: postgresql://skinspire_admin:***@localhost:5432/skinspire_test
2025-03-25 18:11:17,846 - INFO -   PROD_DATABASE_URL: postgresql://skinspire_admin:***@localhost:5432/skinspire_prod
2025-03-25 18:11:17,846 - INFO - Testing connection to database: postgresql://skinspire_admin:***@localhost:5432/skinspire_dev
2025-03-25 18:11:18,252 - INFO - [32mDatabase connection successful for dev environment[0m
2025-03-25 18:11:18,252 - INFO - [32mPASS:[0m Configuration - Dev Database Connection
2025-03-25 18:11:18,253 - INFO - Testing connection to database: postgresql://skinspire_admin:***@localhost:5432/skinspire_test
2025-03-25 18:11:18,288 - INFO - [32mDatabase connection successful for test environment[0m
2025-03-25 18:11:18,288 - INFO - [32mPASS:[0m Configuration - Test Database Connection
2025-03-25 18:11:18,289 - INFO - 
[36m============================================================
2025-03-25 18:11:18,289 - INFO -                 TESTING BACKUP AND RESTORE                
2025-03-25 18:11:18,290 - INFO - ============================================================[0m
2025-03-25 18:11:18,290 - INFO - Testing connection to database: postgresql://skinspire_admin:***@localhost:5432/skinspire_test
2025-03-25 18:11:18,324 - INFO - [32mDatabase connection successful for test environment[0m
2025-03-25 18:11:18,381 - INFO - [32mPASS:[0m Backup - Create Test Table
2025-03-25 18:11:18,383 - INFO - [32mPASS:[0m Backup - Insert Test Data
2025-03-25 18:11:18,384 - INFO - Test data verified: [(1, 'test_value', datetime.datetime(2025, 3, 25, 18, 11, 18, 359107))]
2025-03-25 18:11:18,384 - INFO - [32mPASS:[0m Backup - Verify Test Data
2025-03-25 18:11:18,386 - INFO - 
[36m============================================================
2025-03-25 18:11:18,386 - INFO -                  BACKING UP TEST DATABASE                 
2025-03-25 18:11:18,387 - INFO - ============================================================[0m
2025-03-25 18:11:18,387 - INFO - Running command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py create-backup --env test --output test_backup_20250325_181118.sql
2025-03-25 18:11:19,294 - INFO - manage_db.py: Creating backup of test database...
2025-03-25 18:11:19,295 - INFO - manage_db.py: SUCCESS: Backup created successfully: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\backups\test_backup_20250325_181118.sql
2025-03-25 18:11:19,295 - INFO - Backup created successfully: backups\test_backup_20250325_181118.sql
2025-03-25 18:11:19,296 - INFO - [32mPASS:[0m Backup test Database
2025-03-25 18:11:19,299 - INFO - [32mPASS:[0m Backup - Modify Table
2025-03-25 18:11:19,304 - INFO - [32mColumn 'extra' was added successfully[0m
2025-03-25 18:11:19,304 - INFO - [32mPASS:[0m Backup - Verify Column Added
2025-03-25 18:11:19,305 - INFO - 
[36m============================================================
2025-03-25 18:11:19,306 - INFO -                  RESTORING TEST DATABASE                 
2025-03-25 18:11:19,306 - INFO - ============================================================[0m
2025-03-25 18:11:19,306 - INFO - Running command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py restore-backup backups\test_backup_20250325_181118.sql
2025-03-25 18:11:19,307 - INFO - Updated .flask_env_type with 'test'
2025-03-25 18:11:21,039 - INFO - manage_db.py: Using environment from centralized configuration: test (testing)
2025-03-25 18:11:21,040 - INFO - manage_db.py: Warning! This will restore the test database from backups\test_backup_20250325_181118.sql. Are you sure? [y/N]: Restoring test database from backups\test_backup_20250325_181118.sql...
2025-03-25 18:11:21,040 - INFO - manage_db.py: SUCCESS: Database restored successfully
2025-03-25 18:11:21,041 - INFO - Successfully restored test database from backups\test_backup_20250325_181118.sql
2025-03-25 18:11:21,041 - INFO - [32mPASS:[0m Restore test Database
2025-03-25 18:11:21,044 - INFO - [32mColumn 'extra' was removed successfully during restore[0m
2025-03-25 18:11:21,044 - INFO - [32mPASS:[0m Backup - Verify Restore
2025-03-25 18:11:21,046 - INFO - Cleaned up test table
2025-03-25 18:11:21,048 - INFO - 
[36m============================================================
2025-03-25 18:11:21,048 - INFO -                   TESTING DATABASE COPY                  
2025-03-25 18:11:21,048 - INFO - ============================================================[0m
2025-03-25 18:11:21,049 - INFO - Testing connection to database: postgresql://skinspire_admin:***@localhost:5432/skinspire_dev
2025-03-25 18:11:21,083 - INFO - [32mDatabase connection successful for dev environment[0m
2025-03-25 18:11:21,083 - INFO - Testing connection to database: postgresql://skinspire_admin:***@localhost:5432/skinspire_test
2025-03-25 18:11:21,121 - INFO - [32mDatabase connection successful for test environment[0m
2025-03-25 18:11:21,122 - INFO - 
[36m============================================================
2025-03-25 18:11:21,122 - INFO -                  BACKING UP DEV DATABASE                 
2025-03-25 18:11:21,122 - INFO - ============================================================[0m
2025-03-25 18:11:21,122 - INFO - Running command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py create-backup --env dev --output dev_backup_20250325_181121.sql
2025-03-25 18:11:21,940 - INFO - manage_db.py: Creating backup of dev database...
2025-03-25 18:11:21,941 - INFO - manage_db.py: SUCCESS: Backup created successfully: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\backups\dev_backup_20250325_181121.sql
2025-03-25 18:11:21,941 - INFO - Backup created successfully: backups\dev_backup_20250325_181121.sql
2025-03-25 18:11:21,941 - INFO - [32mPASS:[0m Backup dev Database
2025-03-25 18:11:21,942 - INFO - 
[36m============================================================
2025-03-25 18:11:21,942 - INFO -                  BACKING UP TEST DATABASE                 
2025-03-25 18:11:21,942 - INFO - ============================================================[0m
2025-03-25 18:11:21,943 - INFO - Running command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py create-backup --env test --output test_backup_20250325_181121.sql
2025-03-25 18:11:22,688 - INFO - manage_db.py: Creating backup of test database...
2025-03-25 18:11:22,689 - INFO - manage_db.py: SUCCESS: Backup created successfully: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\backups\test_backup_20250325_181121.sql
2025-03-25 18:11:22,689 - INFO - Backup created successfully: backups\test_backup_20250325_181121.sql
2025-03-25 18:11:22,690 - INFO - [32mPASS:[0m Backup test Database
2025-03-25 18:11:22,733 - INFO - [32mPASS:[0m DB Copy - Create Dev Test Table
2025-03-25 18:11:22,735 - INFO - [32mPASS:[0m DB Copy - Insert Dev Test Data
2025-03-25 18:11:22,735 - INFO - [32mDev test data verified: [(1, 'dev', 100)][0m
2025-03-25 18:11:22,735 - INFO - [32mPASS:[0m DB Copy - Verify Dev Test Data
2025-03-25 18:11:22,737 - INFO - Running command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py copy-db dev test
2025-03-25 18:11:24,418 - INFO - manage_db.py: Warning! This will copy database from dev to test. Are you sure? [y/N]: Starting database copy from dev to test...
2025-03-25 18:11:24,419 - INFO - manage_db.py: SUCCESS: Database copied successfully from dev to test
2025-03-25 18:11:24,419 - INFO - [32mPASS:[0m DB Copy - Copy Dev to Test
2025-03-25 18:11:24,453 - INFO - [32mTest database data verified: [(1, 'dev', 100)][0m
2025-03-25 18:11:24,454 - INFO - [32mPASS:[0m DB Copy - Verify Test Data
2025-03-25 18:11:24,454 - INFO - [32mPASS:[0m DB Copy - Modify Test Data
2025-03-25 18:11:24,458 - INFO - [32mPASS:[0m DB Copy - Modify Dev Schema
2025-03-25 18:11:24,458 - INFO - Running command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py copy-db dev test --schema-only
2025-03-25 18:11:26,148 - INFO - manage_db.py: Warning! This will copy database from dev to test. Are you sure? [y/N]: Starting database copy from dev to test...
2025-03-25 18:11:26,148 - INFO - manage_db.py: Copy options: schema only
2025-03-25 18:11:26,149 - INFO - manage_db.py: SUCCESS: Database copied successfully from dev to test
2025-03-25 18:11:26,149 - INFO - [32mPASS:[0m DB Copy - Schema-Only Copy
2025-03-25 18:11:26,149 - INFO - [32mSchema-only copy behavior verified[0m
2025-03-25 18:11:26,149 - INFO - [32mPASS:[0m DB Copy - Verify Schema Update
2025-03-25 18:11:26,151 - INFO - [32mData preserved during schema copy[0m
2025-03-25 18:11:26,151 - INFO - [32mPASS:[0m DB Copy - Verify Data Preserved
2025-03-25 18:11:26,152 - INFO - Cleaned up test table in dev database
2025-03-25 18:11:26,156 - INFO - Cleaned up test table in test database
2025-03-25 18:11:26,158 - INFO - Restoring databases to original state
2025-03-25 18:11:26,158 - INFO - 
[36m============================================================
2025-03-25 18:11:26,158 - INFO -                   RESTORING DEV DATABASE                  
2025-03-25 18:11:26,159 - INFO - ============================================================[0m
2025-03-25 18:11:26,159 - INFO - Running command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py restore-backup backups\dev_backup_20250325_181121.sql
2025-03-25 18:11:26,160 - INFO - Updated .flask_env_type with 'dev'
2025-03-25 18:11:27,810 - INFO - manage_db.py: Using environment from centralized configuration: dev (development)
2025-03-25 18:11:27,810 - INFO - manage_db.py: Warning! This will restore the dev database from backups\dev_backup_20250325_181121.sql. Are you sure? [y/N]: Restoring dev database from backups\dev_backup_20250325_181121.sql...
2025-03-25 18:11:27,810 - INFO - manage_db.py: SUCCESS: Database restored successfully
2025-03-25 18:11:27,811 - INFO - Successfully restored dev database from backups\dev_backup_20250325_181121.sql
2025-03-25 18:11:27,811 - INFO - [32mPASS:[0m Restore dev Database
2025-03-25 18:11:27,811 - INFO - 
[36m============================================================
2025-03-25 18:11:27,811 - INFO -                  RESTORING TEST DATABASE                 
2025-03-25 18:11:27,811 - INFO - ============================================================[0m
2025-03-25 18:11:27,811 - INFO - Running command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py restore-backup backups\test_backup_20250325_181121.sql
2025-03-25 18:11:27,812 - INFO - Updated .flask_env_type with 'test'
2025-03-25 18:11:29,637 - INFO - manage_db.py: Using environment from centralized configuration: test (testing)
2025-03-25 18:11:29,637 - INFO - manage_db.py: Warning! This will restore the test database from backups\test_backup_20250325_181121.sql. Are you sure? [y/N]: Restoring test database from backups\test_backup_20250325_181121.sql...
2025-03-25 18:11:29,637 - INFO - manage_db.py: SUCCESS: Database restored successfully
2025-03-25 18:11:29,637 - INFO - Successfully restored test database from backups\test_backup_20250325_181121.sql
2025-03-25 18:11:29,638 - INFO - [32mPASS:[0m Restore test Database
2025-03-25 18:11:29,638 - INFO - 
[36m============================================================
2025-03-25 18:11:29,638 - INFO -                 TESTING TRIGGER MANAGEMENT                
2025-03-25 18:11:29,638 - INFO - ============================================================[0m
2025-03-25 18:11:29,638 - INFO - Testing connection to database: postgresql://skinspire_admin:***@localhost:5432/skinspire_test
2025-03-25 18:11:29,675 - INFO - [32mDatabase connection successful for test environment[0m
2025-03-25 18:11:29,676 - INFO - 
[36m============================================================
2025-03-25 18:11:29,676 - INFO -                  BACKING UP TEST DATABASE                 
2025-03-25 18:11:29,676 - INFO - ============================================================[0m
2025-03-25 18:11:29,677 - INFO - Running command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py create-backup --env test --output test_backup_20250325_181129.sql
2025-03-25 18:11:30,473 - INFO - manage_db.py: Creating backup of test database...
2025-03-25 18:11:30,473 - INFO - manage_db.py: SUCCESS: Backup created successfully: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\backups\test_backup_20250325_181129.sql
2025-03-25 18:11:30,473 - INFO - Backup created successfully: backups\test_backup_20250325_181129.sql
2025-03-25 18:11:30,474 - INFO - [32mPASS:[0m Backup test Database
2025-03-25 18:11:30,515 - INFO - [32mPASS:[0m Triggers - Create Test Table
2025-03-25 18:11:30,516 - INFO - [32mPASS:[0m Triggers - Use/Create Trigger Function
2025-03-25 18:11:30,517 - INFO - [32mPASS:[0m Triggers - Create Trigger
2025-03-25 18:11:30,519 - INFO - [32mPASS:[0m Triggers - Insert Test Data
2025-03-25 18:11:30,520 - INFO - [32mTimestamp was set correctly: 2025-03-25 18:11:30.509851[0m
2025-03-25 18:11:30,520 - INFO - [32mPASS:[0m Triggers - Verify Created Timestamp
2025-03-25 18:11:30,521 - INFO - [32mPASS:[0m Triggers - Update Test Data
2025-03-25 18:11:30,521 - INFO - [32mUpdated timestamp was set correctly: 2025-03-25 12:41:30.509851[0m
2025-03-25 18:11:30,521 - INFO - [32mPASS:[0m Triggers - Verify Updated Timestamp
2025-03-25 18:11:30,522 - INFO - Cleaned up test table and trigger function
2025-03-25 18:11:30,524 - INFO - Restoring test database to original state
2025-03-25 18:11:30,524 - INFO - 
[36m============================================================
2025-03-25 18:11:30,524 - INFO -                  RESTORING TEST DATABASE                 
2025-03-25 18:11:30,525 - INFO - ============================================================[0m
2025-03-25 18:11:30,525 - INFO - Running command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py restore-backup backups\test_backup_20250325_181129.sql
2025-03-25 18:11:30,526 - INFO - Updated .flask_env_type with 'test'
2025-03-25 18:11:32,063 - INFO - manage_db.py: Using environment from centralized configuration: test (testing)
2025-03-25 18:11:32,063 - INFO - manage_db.py: Warning! This will restore the test database from backups\test_backup_20250325_181129.sql. Are you sure? [y/N]: Restoring test database from backups\test_backup_20250325_181129.sql...
2025-03-25 18:11:32,063 - INFO - manage_db.py: SUCCESS: Database restored successfully
2025-03-25 18:11:32,064 - INFO - Successfully restored test database from backups\test_backup_20250325_181129.sql
2025-03-25 18:11:32,064 - INFO - [32mPASS:[0m Restore test Database
2025-03-25 18:11:32,064 - INFO - 
[36m============================================================
2025-03-25 18:11:32,064 - INFO -               TESTING ENVIRONMENT SWITCHING              
2025-03-25 18:11:32,065 - INFO - ============================================================[0m
2025-03-25 18:11:32,065 - INFO - Original environment: test
2025-03-25 18:11:32,065 - INFO - Original FLASK_ENV in .env: test
2025-03-25 18:11:32,066 - INFO - Running status command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py switch-env --status
2025-03-25 18:11:32,679 - INFO - Environment status:
2025-03-25 18:11:32,679 - INFO -   Current environment: testing
2025-03-25 18:11:32,680 - INFO -   Short name: test
2025-03-25 18:11:32,680 - INFO -   Environment type file (.flask_env_type): test
2025-03-25 18:11:32,680 - INFO -   FLASK_ENV in .env file: test
2025-03-25 18:11:32,681 - INFO -   FLASK_ENV environment variable: test
2025-03-25 18:11:32,681 - INFO -   SKINSPIRE_ENV environment variable: Not set
2025-03-25 18:11:32,681 - INFO -   
2025-03-25 18:11:32,681 - INFO -   Database URLs:
2025-03-25 18:11:32,681 - INFO -     development: postgresql://skinspire_admin:****@localhost:5432/skinspire_dev
2025-03-25 18:11:32,681 - INFO -     testing: postgresql://skinspire_admin:****@localhost:5432/skinspire_test
2025-03-25 18:11:32,682 - INFO -     production: postgresql://skinspire_admin:****@localhost:5432/skinspire_prod
2025-03-25 18:11:32,682 - INFO - [32mPASS:[0m Switch Env - Status Check
2025-03-25 18:11:32,682 - INFO - Running switch command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py switch-env test
2025-03-25 18:11:33,281 - INFO - Environment switch output:
2025-03-25 18:11:33,282 - INFO -   Environment switched to: testing
2025-03-25 18:11:33,282 - INFO -   Database URL: postgresql://skinspire_admin:****@localhost:5432/skinspire_test
2025-03-25 18:11:33,282 - INFO - [32mPASS:[0m Switch Env - Switch to Test
2025-03-25 18:11:33,283 - INFO - [32mEnvironment type file updated to 'test'[0m
2025-03-25 18:11:33,283 - INFO - [32mPASS:[0m Switch Env - Verify File Update
2025-03-25 18:11:33,283 - INFO - Running switch command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py switch-env dev
2025-03-25 18:11:33,902 - INFO - Environment switch output:
2025-03-25 18:11:33,902 - INFO -   Environment switched to: development
2025-03-25 18:11:33,903 - INFO -   Database URL: postgresql://skinspire_admin:****@localhost:5432/skinspire_test
2025-03-25 18:11:33,903 - INFO - [32mPASS:[0m Switch Env - Switch to Dev
2025-03-25 18:11:33,904 - INFO - [32mEnvironment type file updated to 'dev'[0m
2025-03-25 18:11:33,904 - INFO - [32mPASS:[0m Switch Env - Verify Second File Update
2025-03-25 18:11:33,905 - INFO - Restoring original FLASK_ENV in .env file: test
2025-03-25 18:11:33,906 - INFO - [32mEnvironment switch tests completed successfully[0m
2025-03-25 18:11:33,906 - INFO - 
[36m============================================================
2025-03-25 18:11:33,906 - INFO -                TESTING DATABASE INSPECTION               
2025-03-25 18:11:33,906 - INFO - ============================================================[0m
2025-03-25 18:11:33,907 - INFO - Testing connection to database: postgresql://skinspire_admin:***@localhost:5432/skinspire_test
2025-03-25 18:11:34,055 - INFO - [32mDatabase connection successful for test environment[0m
2025-03-25 18:11:34,103 - INFO - [32mPASS:[0m DB Inspect - Create Test Table
2025-03-25 18:11:34,105 - INFO - Running inspect command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py inspect-db test
2025-03-25 18:11:34,869 - INFO - Database inspection output:
2025-03-25 18:11:34,870 - INFO -   Connecting to database: postgresql://skinspire_admin:****@localhost:5432/skinspire_test
2025-03-25 18:11:34,870 - INFO -   
2025-03-25 18:11:34,870 - INFO -   === CONNECTING TO DATABASE ===
2025-03-25 18:11:34,871 - INFO -   
2025-03-25 18:11:34,871 - INFO -   === DATABASE OVERVIEW ===
2025-03-25 18:11:34,871 - INFO -   Found 2 user-defined schemas:
2025-03-25 18:11:34,871 - INFO -     - application: 0 tables
2025-03-25 18:11:34,871 - INFO -     - public: 13 tables
2025-03-25 18:11:34,871 - INFO -   
2025-03-25 18:11:34,871 - INFO -   Database: skinspire_test
2025-03-25 18:11:34,871 - INFO -   Version: PostgreSQL 17.2 on x86_64-windows, compiled by msvc-19.42.34435, 64-bit
2025-03-25 18:11:34,871 - INFO -   Size: 11 MB (11340947 bytes)
2025-03-25 18:11:34,872 - INFO -   Total tables: 13
2025-03-25 18:11:34,872 - INFO -   Total functions: 55
2025-03-25 18:11:34,872 - INFO -   Total triggers: 81
2025-03-25 18:11:34,872 - INFO - [32mPASS:[0m DB Inspect - General Overview
2025-03-25 18:11:34,872 - INFO - Running tables command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py inspect-db test --tables
2025-03-25 18:11:35,606 - INFO - [32mPASS:[0m DB Inspect - Tables Listing
2025-03-25 18:11:35,606 - INFO - Running table detail command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py inspect-db test --table _test_inspect_table
2025-03-25 18:11:36,342 - INFO - Table inspection output:
2025-03-25 18:11:36,342 - INFO -   Connecting to database: postgresql://skinspire_admin:****@localhost:5432/skinspire_test
2025-03-25 18:11:36,343 - INFO -   
2025-03-25 18:11:36,343 - INFO -   === CONNECTING TO DATABASE ===
2025-03-25 18:11:36,344 - INFO -   
2025-03-25 18:11:36,344 - INFO -   === TABLE DETAILS: public._test_inspect_table ===
2025-03-25 18:11:36,345 - INFO -   
2025-03-25 18:11:36,345 - INFO -   Columns (6):
2025-03-25 18:11:36,346 - INFO -     id INTEGER NOT NULL DEFAULT nextval('"public"._test_inspect_table_id_seq'::regclass)
2025-03-25 18:11:36,346 - INFO -     name VARCHAR(100) NOT NULL
2025-03-25 18:11:36,346 - INFO -     description TEXT NULL
2025-03-25 18:11:36,346 - INFO -     is_active BOOLEAN NULL DEFAULT true
2025-03-25 18:11:36,346 - INFO -     created_at TIMESTAMP NULL DEFAULT now()
2025-03-25 18:11:36,346 - INFO -     value NUMERIC(10, 2) NULL
2025-03-25 18:11:36,347 - INFO -   
2025-03-25 18:11:36,347 - INFO -   Primary Key: id
2025-03-25 18:11:36,347 - INFO -   
2025-03-25 18:11:36,347 - INFO -   Indexes (1):
2025-03-25 18:11:36,347 - INFO -     idx_test_inspect_name: (name)
2025-03-25 18:11:36,347 - INFO -   
2025-03-25 18:11:36,347 - INFO -   Statistics:
2025-03-25 18:11:36,347 - INFO -     Row count: 2
2025-03-25 18:11:36,347 - INFO -     Total size: 48 kB
2025-03-25 18:11:36,347 - INFO -     Table size: 8192 bytes
2025-03-25 18:11:36,347 - INFO -     Index size: 32 kB
2025-03-25 18:11:36,348 - INFO - [32mPASS:[0m DB Inspect - Table Detail
2025-03-25 18:11:36,348 - INFO - [32mPASS:[0m DB Inspect - Index Information
2025-03-25 18:11:36,348 - INFO - Running functions command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py inspect-db test --functions
2025-03-25 18:11:37,038 - INFO - [32mPASS:[0m DB Inspect - Functions Listing
2025-03-25 18:11:37,038 - INFO - Running triggers command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py inspect-db test --triggers
2025-03-25 18:11:37,718 - INFO - [32mPASS:[0m DB Inspect - Triggers Listing
2025-03-25 18:11:37,721 - INFO - Cleaned up test table
2025-03-25 18:11:37,724 - INFO - [32mDatabase inspection tests completed successfully[0m
2025-03-25 18:11:37,724 - INFO - 
[36m============================================================
2025-03-25 18:11:37,725 - INFO -                 TESTING SCHEMA MANAGEMENT                
2025-03-25 18:11:37,725 - INFO - ============================================================[0m
2025-03-25 18:11:37,726 - INFO - Testing connection to database: postgresql://skinspire_admin:***@localhost:5432/skinspire_dev
2025-03-25 18:11:37,759 - INFO - [32mDatabase connection successful for dev environment[0m
2025-03-25 18:11:37,760 - INFO - 
[36m============================================================
2025-03-25 18:11:37,760 - INFO -                  BACKING UP DEV DATABASE                 
2025-03-25 18:11:37,760 - INFO - ============================================================[0m
2025-03-25 18:11:37,760 - INFO - Running command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py create-backup --env dev --output dev_backup_20250325_181137.sql
2025-03-25 18:11:38,520 - INFO - manage_db.py: Creating backup of dev database...
2025-03-25 18:11:38,520 - INFO - manage_db.py: SUCCESS: Backup created successfully: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\backups\dev_backup_20250325_181137.sql
2025-03-25 18:11:38,521 - INFO - Backup created successfully: backups\dev_backup_20250325_181137.sql
2025-03-25 18:11:38,521 - INFO - [32mPASS:[0m Backup dev Database
2025-03-25 18:11:38,521 - INFO - Testing schema sync functionality...
2025-03-25 18:11:38,559 - INFO - [32mCreated test table with initial schema[0m
2025-03-25 18:11:38,559 - INFO - [32mPASS:[0m Schema Mgmt - Create Initial Table
2025-03-25 18:11:38,585 - INFO - Initial columns: ['id', 'name', 'created_at']
2025-03-25 18:11:38,591 - INFO - [32mAdded 'description' column[0m
2025-03-25 18:11:38,591 - INFO - [32mPASS:[0m Schema Mgmt - Add Column
2025-03-25 18:11:38,592 - INFO - Running detect-schema-changes command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py detect-schema-changes
2025-03-25 18:11:38,593 - INFO - Updated .flask_env_type with 'dev'
2025-03-25 18:11:39,832 - INFO - Schema change detection output:
2025-03-25 18:11:39,832 - INFO -   Detecting schema changes...
2025-03-25 18:11:39,832 - INFO -   
2025-03-25 18:11:39,833 - INFO -   Detected 35 changes:
2025-03-25 18:11:39,833 - INFO -   - Extra table in database: _test_backup_table
2025-03-25 18:11:39,833 - INFO -   - Extra table in database: _test_schema_table
2025-03-25 18:11:39,833 - INFO -   - Column type change: staff.created_at
2025-03-25 18:11:39,834 - INFO -   - Column type change: staff.updated_at
2025-03-25 18:11:39,834 - INFO -   - Column type change: staff.deleted_at
2025-03-25 18:11:39,834 - INFO -   - Column type change: role_module_access.created_at
2025-03-25 18:11:39,834 - INFO -   - Column type change: role_module_access.updated_at
2025-03-25 18:11:39,834 - INFO -   - Column type change: role_master.created_at
2025-03-25 18:11:39,834 - INFO -   - Column type change: role_master.updated_at
2025-03-25 18:11:39,834 - INFO -   - Column type change: user_role_mapping.created_at
2025-03-25 18:11:39,834 - INFO -   - Column type change: user_role_mapping.updated_at
2025-03-25 18:11:39,834 - INFO -   - Column type change: user_sessions.created_at
2025-03-25 18:11:39,834 - INFO -   - Column type change: user_sessions.expires_at
2025-03-25 18:11:39,834 - INFO -   - Column type change: user_sessions.updated_at
2025-03-25 18:11:39,835 - INFO -   - Column type change: module_master.created_at
2025-03-25 18:11:39,835 - INFO -   - Column type change: module_master.updated_at
2025-03-25 18:11:39,835 - INFO -   - Column type change: patients.created_at
2025-03-25 18:11:39,835 - INFO -   - Column type change: patients.updated_at
2025-03-25 18:11:39,835 - INFO -   - Column type change: patients.deleted_at
2025-03-25 18:11:39,836 - INFO -   - Column type change: branches.created_at
2025-03-25 18:11:39,836 - INFO -   - Column type change: branches.updated_at
2025-03-25 18:11:39,836 - INFO -   - Column type change: branches.deleted_at
2025-03-25 18:11:39,836 - INFO -   - Column type change: hospitals.created_at
2025-03-25 18:11:39,837 - INFO -   - Column type change: hospitals.updated_at
2025-03-25 18:11:39,837 - INFO -   - Column type change: hospitals.deleted_at
2025-03-25 18:11:39,837 - INFO -   - Column type change: users.last_login
2025-03-25 18:11:39,837 - INFO -   - Column type change: users.created_at
2025-03-25 18:11:39,837 - INFO -   - Column type change: users.updated_at
2025-03-25 18:11:39,837 - INFO -   - Column type change: users.deleted_at
2025-03-25 18:11:39,837 - INFO -   - Column type change: parameter_settings.created_at
2025-03-25 18:11:39,838 - INFO -   - Column type change: parameter_settings.updated_at
2025-03-25 18:11:39,838 - INFO -   - Column type change: login_history.login_time
2025-03-25 18:11:39,838 - INFO -   - Column type change: login_history.logout_time
2025-03-25 18:11:39,838 - INFO -   - Column type change: login_history.created_at
2025-03-25 18:11:39,838 - INFO -   - Column type change: login_history.updated_at
2025-03-25 18:11:39,838 - INFO -   
2025-03-25 18:11:39,839 - INFO -   To create a migration with these changes:
2025-03-25 18:11:39,839 - INFO -     python scripts/manage_db.py prepare-migration -m "Your migration message"
2025-03-25 18:11:39,839 - INFO - [32mPASS:[0m Schema Mgmt - Detect Schema Changes
2025-03-25 18:11:39,839 - INFO - Running prepare-migration command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py prepare-migration -m Test schema changes
2025-03-25 18:11:42,230 - ERROR - [31mError running prepare-migration: Command '['C:\\Users\\vinod\\AppData\\Local\\Programs\\Skinspire Repository\\skinspire_v2\\skinspire_v2_env\\Scripts\\python.exe', 'scripts/manage_db.py', 'prepare-migration', '-m', 'Test schema changes']' returned non-zero exit status 1.[0m
2025-03-25 18:11:42,231 - ERROR - Standard output: Detecting model changes...

Detected changes:
- Extra table in database: _test_backup_table
- Extra table in database: _test_schema_table
- Column type change: hospitals.created_at
- Column type change: hospitals.updated_at
- Column type change: hospitals.deleted_at
- Column type change: patients.created_at
- Column type change: patients.updated_at
- Column type change: patients.deleted_at
- Column type change: module_master.created_at
- Column type change: module_master.updated_at
- Column type change: branches.created_at
- Column type change: branches.updated_at
- Column type change: branches.deleted_at
- Column type change: role_master.created_at
- Column type change: role_master.updated_at
- Column type change: role_module_access.created_at
- Column type change: role_module_access.updated_at
- Column type change: staff.created_at
- Column type change: staff.updated_at
- Column type change: staff.deleted_at
- Column type change: users.last_login
- Column type change: users.created_at
- Column type change: users.updated_at
- Column type change: users.deleted_at
- Column type change: user_sessions.created_at
- Column type change: user_sessions.expires_at
- Column type change: user_sessions.updated_at
- Column type change: parameter_settings.created_at
- Column type change: parameter_settings.updated_at
- Column type change: user_role_mapping.created_at
- Column type change: user_role_mapping.updated_at
- Column type change: login_history.login_time
- Column type change: login_history.logout_time
- Column type change: login_history.created_at
- Column type change: login_history.updated_at
Create migration file with these changes? [y/N]: FAILED: Migration creation failed

2025-03-25 18:11:42,231 - ERROR - Standard error: 2025-03-25 18:11:39,939 - INFO - Using centralized environment: development
2025-03-25 18:11:40,410 - INFO - Using database URL from centralized configuration for environment: development
2025-03-25 18:11:40,743 - INFO - Redis initialized successfully
2025-03-25 18:11:40,744 - INFO - Registered view blueprints
2025-03-25 18:11:40,746 - INFO - Successfully registered view blueprint: auth_views
2025-03-25 18:11:40,747 - INFO - Successfully imported core blueprints
2025-03-25 18:11:40,747 - INFO - Added core blueprints to registration list
2025-03-25 18:11:40,747 - INFO - Attempting to import security blueprints...
2025-03-25 18:11:40,750 - WARNING - The app.database module is deprecated. Please use app.services.database_service instead.
2025-03-25 18:11:40,751 - INFO - Database initialized successfully
2025-03-25 18:11:40,773 - INFO - Successfully imported security blueprints
2025-03-25 18:11:40,773 - INFO - Added security blueprints to registration list
2025-03-25 18:11:40,773 - INFO - Successfully registered API blueprint: admin
2025-03-25 18:11:40,773 - INFO - Successfully registered API blueprint: patient
2025-03-25 18:11:40,775 - INFO - Successfully registered API blueprint: security
2025-03-25 18:11:40,776 - INFO - Successfully registered API blueprint: rbac
2025-03-25 18:11:40,776 - INFO - Successfully registered API blueprint: audit
2025-03-25 18:11:40,780 - INFO - Successfully registered API blueprint: auth
2025-03-25 18:11:40,780 - INFO - Application initialization completed successfully
2025-03-25 18:11:40,876 - INFO - Creating backup before migration...
2025-03-25 18:11:40,877 - INFO - Creating backup of dev database to C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\backups\dev_backup_20250325_181140.sql
2025-03-25 18:11:41,023 - INFO - Backup created successfully: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\backups\dev_backup_20250325_181140.sql
2025-03-25 18:11:41,024 - INFO - Creating migration: Test schema changes
2025-03-25 18:11:42,125 - ERROR - Migration failed: Command '['C:\\Users\\vinod\\AppData\\Local\\Programs\\Skinspire Repository\\skinspire_v2\\skinspire_v2_env\\Scripts\\python.exe', '-m', 'flask', 'db', 'migrate', '-m', 'Test schema changes']' returned non-zero exit status 1.
2025-03-25 18:11:42,126 - ERROR - Error: INFO:app:Using centralized environment: development
INFO:app:Using database URL from centralized configuration for environment: development
INFO:app:Redis initialized successfully
INFO:app:Registered view blueprints
INFO:app:Successfully registered view blueprint: auth_views
INFO:app:Successfully imported core blueprints
INFO:app:Added core blueprints to registration list
INFO:app:Attempting to import security blueprints...
WARNING:app.database:The app.database module is deprecated. Please use app.services.database_service instead.
INFO:app.services.database_service:Database initialized successfully
INFO:app:Successfully imported security blueprints
INFO:app:Added security blueprints to registration list
INFO:app:Successfully registered API blueprint: admin
INFO:app:Successfully registered API blueprint: patient
INFO:app:Successfully registered API blueprint: security
INFO:app:Successfully registered API blueprint: rbac
INFO:app:Successfully registered API blueprint: audit
INFO:app:Successfully registered API blueprint: auth
INFO:app:Application initialization completed successfully
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
ERROR [flask_migrate] Error: Target database is not up to date.


2025-03-25 18:11:42,232 - ERROR - [31mFAIL:[0m Schema Mgmt - Prepare Migration - Process error: Command '['C:\\Users\\vinod\\AppData\\Local\\Programs\\Skinspire Repository\\skinspire_v2\\skinspire_v2_env\\Scripts\\python.exe', 'scripts/manage_db.py', 'prepare-migration', '-m', 'Test schema changes']' returned non-zero exit status 1.
2025-03-25 18:11:42,232 - INFO - Running sync-dev-schema command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py sync-dev-schema
2025-03-25 18:11:43,466 - INFO - Sync schema output:
2025-03-25 18:11:43,466 - INFO -   Warning! This will modify your database schema to match models. Continue? [y/N]: Syncing database schema with models...
2025-03-25 18:11:43,467 - INFO -   SUCCESS: Database schema synced with models
2025-03-25 18:11:43,467 - INFO - [32mPASS:[0m Schema Mgmt - Sync Schema
2025-03-25 18:11:43,469 - INFO - Cleaned up test table
2025-03-25 18:11:43,477 - INFO - Restoring dev database to original state
2025-03-25 18:11:43,477 - INFO - 
[36m============================================================
2025-03-25 18:11:43,477 - INFO -                   RESTORING DEV DATABASE                  
2025-03-25 18:11:43,477 - INFO - ============================================================[0m
2025-03-25 18:11:43,478 - INFO - Running command: C:\Users\vinod\AppData\Local\Programs\Skinspire Repository\skinspire_v2\skinspire_v2_env\Scripts\python.exe scripts/manage_db.py restore-backup backups\dev_backup_20250325_181137.sql
2025-03-25 18:11:43,479 - INFO - Updated .flask_env_type with 'dev'
2025-03-25 18:11:45,246 - INFO - manage_db.py: Using environment from centralized configuration: dev (development)
2025-03-25 18:11:45,247 - INFO - manage_db.py: Warning! This will restore the dev database from backups\dev_backup_20250325_181137.sql. Are you sure? [y/N]: Restoring dev database from backups\dev_backup_20250325_181137.sql...
2025-03-25 18:11:45,247 - INFO - manage_db.py: SUCCESS: Database restored successfully
2025-03-25 18:11:45,247 - INFO - Successfully restored dev database from backups\dev_backup_20250325_181137.sql
2025-03-25 18:11:45,247 - INFO - [32mPASS:[0m Restore dev Database
2025-03-25 18:11:45,250 - INFO - Test results saved to db_test_results_20250325_181145.json
2025-03-25 18:11:45,250 - ERROR - [31mTests failed. Exiting with non-zero status.[0m
